# PM2 ç¦»çº¿å®‰è£…åŒ…

è¿™æ˜¯ä¸€ä¸ªç”¨äºåœ¨æ²¡æœ‰äº’è”ç½‘è¿æ¥çš„ç¯å¢ƒä¸­å®‰è£… PM2 è¿›ç¨‹ç®¡ç†å™¨çš„ç¦»çº¿å®‰è£…åŒ…ã€‚è¯¥åŒ…åŒ…å«äº† PM2 åŠå…¶æ‰€æœ‰ä¾èµ–çš„ tgz æ–‡ä»¶ã€‚

## ğŸ“‹ é¡¹ç›®ç»“æ„

```
pm2-installer/
â”œâ”€â”€ README.md                    # æœ¬æ–‡æ¡£
â”œâ”€â”€ install_pm2_offline.sh       # å®‰è£…è„šæœ¬
â””â”€â”€ packages/                    # tgz åŒ…æ–‡ä»¶ç›®å½•
    â”œâ”€â”€ pm2-6.0.8.tgz           # PM2 ä¸»åŒ…
    â”œâ”€â”€ commander-14.0.0.tgz     # ä¾èµ–åŒ…
    â”œâ”€â”€ chokidar-4.0.3.tgz      # ä¾èµ–åŒ…
    â””â”€â”€ ...                      # å…¶ä»–ä¾èµ–åŒ…
```

## âš™ï¸ ç³»ç»Ÿè¦æ±‚

- **Node.js**: éœ€è¦é¢„å…ˆå®‰è£… Node.js (æ¨è v16 æˆ–æ›´é«˜ç‰ˆæœ¬)
- **npm**: Node.js è‡ªå¸¦çš„åŒ…ç®¡ç†å™¨
- **æ“ä½œç³»ç»Ÿ**: Linux/macOS/Windows (éœ€è¦ Bash ç¯å¢ƒ)
- **æƒé™**: éœ€è¦å®‰è£…å…¨å±€åŒ…çš„æƒé™ (å¯èƒ½éœ€è¦ sudo)

## ğŸš€ å®‰è£…æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

1. **ä¸‹è½½æˆ–æ‹·è´** æ•´ä¸ª `pm2-installer` ç›®å½•åˆ°ç›®æ ‡æœåŠ¡å™¨

2. **èµ‹äºˆæ‰§è¡Œæƒé™**ï¼š
   ```bash
   chmod +x install_pm2_offline.sh
   ```

3. **è¿è¡Œå®‰è£…è„šæœ¬**ï¼š
   ```bash
   # ä½¿ç”¨é»˜è®¤ç›®å½• (packages)
   ./install_pm2_offline.sh packages
   
   # æˆ–è€…æŒ‡å®šè‡ªå®šä¹‰ç›®å½•
   ./install_pm2_offline.sh /path/to/tgz/files
   ```

### é«˜çº§ç”¨æ³•

```bash
# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
./install_pm2_offline.sh --help

# ä½¿ç”¨ sudo æƒé™å®‰è£…ï¼ˆå¦‚æœéœ€è¦ï¼‰
sudo ./install_pm2_offline.sh packages
```

### éªŒè¯å®‰è£…

å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š

```bash
# æ£€æŸ¥ PM2 ç‰ˆæœ¬
pm2 --version

# åˆ—å‡ºå½“å‰è¿›ç¨‹
pm2 list

# æµ‹è¯•å¯åŠ¨ä¸€ä¸ªåº”ç”¨
pm2 start app.js --name "test-app"
```

## ğŸ“¦ åˆ¶ä½œ tgz åŒ…çš„æ–¹æ³•

å¦‚æœæ‚¨éœ€è¦åˆ¶ä½œæ–°çš„ç¦»çº¿å®‰è£…åŒ…æˆ–æ›´æ–°ç°æœ‰åŒ…ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š

### æ¨èæ–¹æ³•ï¼šè‡ªåŠ¨è·å–ä¾èµ– (æ¨è)

è¿™æ˜¯æœ€ç®€æ´é«˜æ•ˆçš„æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨è·å– PM2 çš„æ‰€æœ‰ä¾èµ–ï¼š

**å‰ææ¡ä»¶**ï¼š
- ç¡®ä¿ç³»ç»Ÿå·²å®‰è£… `jq` å·¥å…·ç”¨äºè§£æ JSON
  ```bash
  # Ubuntu/Debian
  sudo apt-get install jq
  
  # CentOS/RHEL
  sudo yum install jq
  
  # macOS
  brew install jq
  ```

**æ‰§è¡Œæ­¥éª¤**ï¼š

1. **åˆ›å»ºåŒ…ç›®å½•**ï¼š
   ```bash
   mkdir packages
   cd packages
   ```

2. **è‡ªåŠ¨ä¸‹è½½ PM2 åŠå…¶æ‰€æœ‰ä¾èµ–**ï¼š
   ```bash
   # ä¸‹è½½ PM2 ä¸»åŒ…
   npm pack pm2
   
   # è‡ªåŠ¨è·å–å¹¶ä¸‹è½½æ‰€æœ‰ä¾èµ–
   npm pack $(npm view pm2 dependencies --json | jq -r 'keys[]')
   ```

3. **éªŒè¯åŒ…çš„å®Œæ•´æ€§**ï¼š
   ```bash
   ls -la packages/
   # ç¡®ä¿æ‰€æœ‰å¿…è¦çš„ tgz æ–‡ä»¶éƒ½å­˜åœ¨
   ```

## ğŸ› ï¸ è„šæœ¬åŠŸèƒ½ç‰¹æ€§

### æ™ºèƒ½å®‰è£…é¡ºåº
- è‡ªåŠ¨åˆ†æåŒ…ä¾èµ–å…³ç³»
- æŒ‰æ­£ç¡®é¡ºåºå®‰è£…ä¾èµ–
- PM2 ä¸»åŒ…æœ€åå®‰è£…

### é”™è¯¯å¤„ç†
- å½©è‰²æ—¥å¿—è¾“å‡º (ç»¿è‰²=æˆåŠŸ, é»„è‰²=è­¦å‘Š, çº¢è‰²=é”™è¯¯)
- å¤±è´¥æ—¶è‡ªåŠ¨å°è¯•å¼ºåˆ¶å®‰è£…
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå»ºè®®

### å®‰å…¨ç‰¹æ€§
- è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- éªŒè¯å®‰è£…ç»“æœ
- æ£€æŸ¥ç¯å¢ƒè¦æ±‚

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. "npm æœªæ‰¾åˆ°" é”™è¯¯**
```bash
# ç¡®ä¿ Node.js å·²å®‰è£…
node --version
npm --version

# å¦‚æœæœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… Node.js
# https://nodejs.org/
```

**2. æƒé™ä¸è¶³é”™è¯¯**
```bash
# ä½¿ç”¨ sudo æƒé™
sudo ./install_pm2_offline.sh packages

# æˆ–è€…é…ç½® npm å…¨å±€ç›®å½•
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
export PATH=~/.npm-global/bin:$PATH
```

**3. PM2 å‘½ä»¤æ‰¾ä¸åˆ°**
```bash
# æ£€æŸ¥ npm å…¨å±€ç›®å½•
npm root -g

# æ‰‹åŠ¨æ·»åŠ åˆ° PATH
export PATH=$(npm root -g)/../bin:$PATH

# æ°¸ä¹…æ·»åŠ åˆ°ç¯å¢ƒå˜é‡
echo 'export PATH=$(npm root -g)/../bin:$PATH' >> ~/.bashrc
source ~/.bashrc
```

**4. åŒ…æ–‡ä»¶æŸåæˆ–ç¼ºå¤±**
```bash
# éªŒè¯ tgz æ–‡ä»¶å®Œæ•´æ€§
tar -tzf packages/pm2-*.tgz > /dev/null && echo "æ–‡ä»¶å®Œæ•´" || echo "æ–‡ä»¶æŸå"

# é‡æ–°ä¸‹è½½æŸåçš„åŒ…
npm pack package-name
```

### æ—¥å¿—å’Œè°ƒè¯•

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. **æŸ¥çœ‹è¯¦ç»†è¾“å‡º**ï¼šè„šæœ¬ä¼šæ˜¾ç¤ºæ¯ä¸ªåŒ…çš„å®‰è£…çŠ¶æ€
2. **æ£€æŸ¥ä¸´æ—¶ç›®å½•**ï¼šå®‰è£…å¤±è´¥æ—¶ä¸´æ—¶æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤
3. **æ‰‹åŠ¨å®‰è£…**ï¼šå¯ä»¥æ‰‹åŠ¨è¿è¡Œ `npm install -g package.tgz` æ¥æµ‹è¯•ç‰¹å®šåŒ…

## ğŸ“ æ›´æ–°æŒ‡å—

### æ›´æ–° PM2 ç‰ˆæœ¬

**æ¨èæ–¹æ³•ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰**ï¼š

1. **æ¸…ç©ºç°æœ‰åŒ…æ–‡ä»¶**ï¼š
   ```bash
   rm -rf packages/*.tgz
   cd packages
   ```

2. **é‡æ–°ä¸‹è½½æ‰€æœ‰åŒ…**ï¼š
   ```bash
   # ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ PM2
   npm pack pm2@latest
   
   # è‡ªåŠ¨ä¸‹è½½æ‰€æœ‰ä¾èµ–
   npm pack $(npm view pm2@latest dependencies --json | jq -r 'keys[]')
   ```

3. **æµ‹è¯•æ–°ç‰ˆæœ¬**ï¼š
   ```bash
   cd ..
   ./install_pm2_offline.sh packages
   ```

**æ‰‹åŠ¨æ–¹æ³•**ï¼š

1. **ä¸‹è½½æ–°ç‰ˆæœ¬çš„ PM2**ï¼š
   ```bash
   cd packages
   rm pm2-*.tgz
   npm pack pm2@latest
   ```

2. **æ£€æŸ¥å¹¶æ›´æ–°ä¾èµ–**ï¼š
   ```bash
   # æŸ¥çœ‹ä¾èµ–å˜åŒ–
   npm view pm2@latest dependencies
   
   # ä¸‹è½½æœ‰å˜åŒ–çš„ä¾èµ–
   npm pack new-dependency-name
   ```

### éªŒè¯åŒ…å®Œæ•´æ€§

æ›´æ–°åå»ºè®®éªŒè¯æ‰€æœ‰åŒ…ï¼š

1. **æ£€æŸ¥åŒ…æ–‡ä»¶**ï¼š
   ```bash
   ls -la packages/
   ```

2. **éªŒè¯ä¾èµ–å…³ç³»**ï¼š
   ```bash
   # æ£€æŸ¥ PM2 çš„å½“å‰ä¾èµ–
   npm view pm2 dependencies --json | jq -r 'keys[]'
   
   # å¯¹æ¯”æœ¬åœ°åŒ…æ–‡ä»¶
   ls packages/*.tgz | sed 's/.*\///;s/-[0-9].*//' | sort
   ```

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜ï¼š

1. ç¡®ä¿ Node.js ç‰ˆæœ¬å…¼å®¹ (å»ºè®® v16+)
2. æ£€æŸ¥æ‰€æœ‰ tgz æ–‡ä»¶æ˜¯å¦å®Œæ•´
3. éªŒè¯ç³»ç»Ÿæƒé™è®¾ç½®
4. æŸ¥çœ‹è„šæœ¬è¾“å‡ºçš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å‘å¸ƒã€‚PM2 æœ¬èº«éµå¾ªå…¶åŸå§‹è®¸å¯è¯æ¡æ¬¾ã€‚

---

**æ³¨æ„**: æ­¤ç¦»çº¿å®‰è£…åŒ…é€‚ç”¨äºæ— æ³•è®¿é—® npm ä»“åº“çš„ç¯å¢ƒã€‚åœ¨æœ‰ç½‘ç»œè¿æ¥çš„ç¯å¢ƒä¸­ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨ `npm install -g pm2` è¿›è¡Œå®‰è£…ã€‚